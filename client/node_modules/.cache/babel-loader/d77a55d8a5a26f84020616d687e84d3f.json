{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/scs/OneDrive/Desktop/9 hours insa_allah/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/scs/OneDrive/Desktop/9 hours insa_allah/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"C:/Users/scs/OneDrive/Desktop/9 hours insa_allah/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"C:/Users/scs/OneDrive/Desktop/9 hours insa_allah/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useContext,useState}from\"react\";import{GlobalState}from\"../../../GlobaalState\";import ProductItem from\"../utils/productItem/ProductItem\";import Loading from\"../utils/loading/Loading\";import axios from\"axios\";import Filters from\"./Filters\";import LoadMore from\"./LoadMore\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function Products(){var state=useContext(GlobalState);var _state$productsAPI$pr=_slicedToArray(state.productsAPI.products,2),products=_state$productsAPI$pr[0],setProducts=_state$productsAPI$pr[1];var _state$userAPI$isAdmi=_slicedToArray(state.userAPI.isAdmin,1),isAdmin=_state$userAPI$isAdmi[0];var _state$token=_slicedToArray(state.token,1),token=_state$token[0];var _state$productsAPI$ca=_slicedToArray(state.productsAPI.callback,2),callback=_state$productsAPI$ca[0],setCallback=_state$productsAPI$ca[1];var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isCheck=_useState4[0],setIsCheck=_useState4[1];var handleCheck=function handleCheck(id){products.forEach(function(product){if(product._id===id)product.checked=!product.checked;});setProducts(_toConsumableArray(products));};var deleteProduct=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(id,public_id){var destroyImg,_deleteProduct;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setLoading(true);destroyImg=axios.post(\"/api/destroy\",{public_id:public_id},{headers:{Authorization:token}});_deleteProduct=axios.delete(\"/api/products/\".concat(id),{headers:{Authorization:token}});_context.next=6;return destroyImg;case 6:_context.next=8;return _deleteProduct;case 8:setCallback(!callback);setLoading(false);_context.next=15;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](0);alert(_context.t0.response.data.msg);case 15:case\"end\":return _context.stop();}}},_callee,null,[[0,12]]);}));return function deleteProduct(_x,_x2){return _ref.apply(this,arguments);};}();var checkAll=function checkAll(){products.forEach(function(product){product.checked=!isCheck;});setProducts(_toConsumableArray(products));setIsCheck(!isCheck);};var deleteAll=function deleteAll(){products.forEach(function(product){if(product.checked)deleteProduct(product._id,product.images.public_id);});};if(loading)return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Loading,{})});return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Filters,{}),isAdmin&&/*#__PURE__*/_jsxs(\"div\",{className:\"delete-all\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Select all\"}),/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:isCheck,onChange:checkAll}),/*#__PURE__*/_jsx(\"button\",{onClick:deleteAll,children:\"Delete ALL\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"products\",children:products.map(function(product){return/*#__PURE__*/_jsx(ProductItem,{product:product,isAdmin:isAdmin,deleteProduct:deleteProduct,handleCheck:handleCheck},product._id);})}),/*#__PURE__*/_jsx(LoadMore,{}),products.length===0&&/*#__PURE__*/_jsx(Loading,{})]});}export default Products;","map":{"version":3,"names":["React","useContext","useState","GlobalState","ProductItem","Loading","axios","Filters","LoadMore","Products","state","productsAPI","products","setProducts","userAPI","isAdmin","token","callback","setCallback","loading","setLoading","isCheck","setIsCheck","handleCheck","id","forEach","product","_id","checked","deleteProduct","public_id","destroyImg","post","headers","Authorization","delete","alert","response","data","msg","checkAll","deleteAll","images","map","length"],"sources":["C:/Users/scs/OneDrive/Desktop/9 hours insa_allah/client/src/components/mainpages/products/Products.js"],"sourcesContent":["import React, { useContext, useState } from \"react\";\r\nimport { GlobalState } from \"../../../GlobaalState\";\r\nimport ProductItem from \"../utils/productItem/ProductItem\";\r\nimport Loading from \"../utils/loading/Loading\";\r\nimport axios from \"axios\";\r\nimport Filters from \"./Filters\";\r\nimport LoadMore from \"./LoadMore\";\r\n\r\nfunction Products() {\r\n  const state = useContext(GlobalState);\r\n  const [products, setProducts] = state.productsAPI.products;\r\n  const [isAdmin] = state.userAPI.isAdmin;\r\n  const [token] = state.token;\r\n  const [callback, setCallback] = state.productsAPI.callback;\r\n  const [loading, setLoading] = useState(false);\r\n  const [isCheck, setIsCheck] = useState(false);\r\n\r\n  const handleCheck = (id) => {\r\n    products.forEach((product) => {\r\n      if (product._id === id) product.checked = !product.checked;\r\n    });\r\n    setProducts([...products]);\r\n  };\r\n\r\n  const deleteProduct = async (id, public_id) => {\r\n    try {\r\n      setLoading(true);\r\n      const destroyImg = axios.post(\r\n        \"/api/destroy\",\r\n        { public_id },\r\n        {\r\n          headers: { Authorization: token },\r\n        }\r\n      );\r\n      const deleteProduct = axios.delete(`/api/products/${id}`, {\r\n        headers: { Authorization: token },\r\n      });\r\n\r\n      await destroyImg;\r\n      await deleteProduct;\r\n      setCallback(!callback);\r\n      setLoading(false);\r\n    } catch (err) {\r\n      alert(err.response.data.msg);\r\n    }\r\n  };\r\n\r\n  const checkAll = () => {\r\n    products.forEach((product) => {\r\n      product.checked = !isCheck;\r\n    });\r\n    setProducts([...products]);\r\n    setIsCheck(!isCheck);\r\n  };\r\n\r\n  const deleteAll = () => {\r\n    products.forEach((product) => {\r\n      if (product.checked) deleteProduct(product._id, product.images.public_id);\r\n    });\r\n  };\r\n\r\n  if (loading)\r\n    return (\r\n      <div>\r\n        <Loading />\r\n      </div>\r\n    );\r\n  return (\r\n    <>\r\n      <Filters />\r\n\r\n      {isAdmin && (\r\n        <div className=\"delete-all\">\r\n          <span>Select all</span>\r\n          <input type=\"checkbox\" checked={isCheck} onChange={checkAll} />\r\n          <button onClick={deleteAll}>Delete ALL</button>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"products\">\r\n        {products.map((product) => {\r\n          return (\r\n            <ProductItem\r\n              key={product._id}\r\n              product={product}\r\n              isAdmin={isAdmin}\r\n              deleteProduct={deleteProduct}\r\n              handleCheck={handleCheck}\r\n            />\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      <LoadMore />\r\n      {products.length === 0 && <Loading />}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default Products;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}